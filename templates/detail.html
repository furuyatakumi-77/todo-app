{% extends "base.html" %}
{% block content %}
<h2 class="mb-4">æœ¬ã®è©³ç´°ãƒ»ç·¨é›†</h2>

<div id="view-mode" class="card p-4 mb-4">
    <h4 class="card-title">{{ book.title | replace('\n', '<br>') | safe }}</h4>
    <ul class="list-group list-group-flush mb-3">
        <li class="list-group-item"><strong>è‘—è€…:</strong> {{ book.author | replace('\n', '<br>') | safe }}</li>
        <li class="list-group-item"><strong>å‡ºç‰ˆç¤¾:</strong> {{ book.publisher or '' }}</li>
        <li class="list-group-item"><strong>ç¨®é¡:</strong> {{ book.genre or '' }}</li>
        <li class="list-group-item"><strong>èª­äº†æ—¥:</strong> {{ book.read_date.strftime('%Y-%m-%d') if book.read_date }}</li>
        <li class="list-group-item"><strong>å€¤æ®µ:</strong> {{ book.price or '' }}</li>
        <li class="list-group-item"><strong>å…¥æ‰‹ãƒ«ãƒ¼ãƒˆ:</strong> {{ book.source or '' }}</li>
        <li class="list-group-item"><strong>ç‚¹æ•°:</strong> {{ book.rating or '' }}</li>
        <li class="list-group-item"><strong>è¦ç´„:</strong> {{ book.summary | replace('\n', '<br>') | safe }}</li>
        <li class="list-group-item"><strong>æ„Ÿæƒ³:</strong> {{ book.review | replace('\n', '<br>') | safe }}</li>
    </ul>

    <h6>çŸ¥è¦‹</h6>
    <ul class="list-group mb-3">
        {% for insight in book.insights %}
            <li class="list-group-item">{{ insight.content }}</li>
        {% else %}
            <li class="list-group-item text-muted">ã¾ã çŸ¥è¦‹ã¯ã‚ã‚Šã¾ã›ã‚“</li>
        {% endfor %}
    </ul>

    <h6>èªå½™</h6>
    <table class="table table-bordered table-sm mb-3">
        <thead class="table-light">
            <tr>
                <th style="width: 20%;">å˜èª</th>
                <th style="width: 80%;">æ„å‘³</th>
            </tr>
        </thead>
        <tbody>
            {% for vocab in book.vocabularies %}
                <tr>
                    <td>{{ vocab.word }}</td>
                    <td style="white-space: normal; word-break: break-word;">
                        {{ vocab.meaning }}
                    </td>
                </tr>
            {% else %}
                <tr><td colspan="2" class="text-muted">ã¾ã èªå½™ã¯ã‚ã‚Šã¾ã›ã‚“</td></tr>
            {% endfor %}
        </tbody>
    </table>

    <button class="btn btn-outline-secondary" onclick="toggleEdit()">âœï¸ ç·¨é›†ãƒ¢ãƒ¼ãƒ‰</button>
    <form action="{{ url_for('delete', book_id=book.id) }}" method="POST" style="display:inline;" onsubmit="return confirm('å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ');">
        <button type="submit" class="btn btn-outline-danger">ğŸ—‘ï¸ å‰Šé™¤</button>
    </form>
</div>



<div id="edit-mode" class="card p-4" style="display:none;">
    <form method="POST">
        <div class="mb-3">
            <label class="form-label">ã‚¿ã‚¤ãƒˆãƒ«: <textarea name="title" rows="2" class="form-control">{{ book.title }}</textarea></label>
        </div>
        <div class="mb-3">
            <label class="form-label">è‘—è€…:<textarea name="author" rows="2" class="form-control">{{ book.author }}</textarea></label>
        </div>
        <div class="mb-3">
            <label class="form-label">å‡ºç‰ˆç¤¾</label>
            <input type="text" name="publisher" class="form-control" value="{{ book.publisher or '' }}">
        </div>
        <div class="mb-3">
            <label class="form-label">ç¨®é¡</label>
            <input type="text" name="genre" class="form-control" value="{{ book.genre or '' }}">
        </div>
        <div class="mb-3">
            <label class="form-label">èª­äº†æ—¥</label>
            <input type="date" name="read_date" class="form-control" value="{{ book.read_date.strftime('%Y-%m-%d') if book.read_date else '' }}">
        </div>
        <div class="mb-3">
            <label class="form-label">å€¤æ®µ</label>
            <input type="number" name="price" class="form-control" value="{{ book.price or '' }}">
        </div>
        <div class="mb-3">
            <label class="form-label">å…¥æ‰‹ãƒ«ãƒ¼ãƒˆ</label>
            <input type="text" name="source" class="form-control" value="{{ book.source or '' }}">
        </div>
        <div class="mb-3">
            <label class="form-label">è¦ç´„</label>
            <textarea name="summary" class="form-control">{{ book.summary or '' }}</textarea>
        </div>
        <div class="mb-3">
            <label class="form-label">ç‚¹æ•°</label>
            <input type="number" name="rating" class="form-control" min="0" max="10" value="{{ book.rating or '' }}">
        </div>
        <div class="mb-3">
            <label class="form-label">æ„Ÿæƒ³</label>
            <textarea name="review" class="form-control">{{ book.review or '' }}</textarea>
        </div>


        <div class="mb-3">
            <h5>çŸ¥è¦‹ï¼ˆç·¨é›†ï¼‰</h5>
            <textarea name="insights_text" class="form-control" rows="5" cols="50">{% for insight in book.insights %}{{ insight.content }}
{% endfor %}</textarea><br>
            <small>â€»1è¡Œï¼1ã¤ã®çŸ¥è¦‹ã¨ã—ã¦ä¿å­˜</small>
        </div>
        <div class="mb-3">
            <h5>èªå½™ï¼ˆç·¨é›†ï¼‰</h5>
            <textarea name="vocab_text" class="form-control" rows="5" cols="50">{% for vocab in book.vocabularies %}{{ vocab.word }} : {{ vocab.meaning }}
{% endfor %}</textarea><br>
            <small>â€»ã€Œå˜èª : æ„å‘³ã€ã®å½¢å¼ã§1è¡Œãšã¤å…¥åŠ›</small>
        </div>
        <button type="submit" class="btn btn-primary">ä¿å­˜</button>
        <button type="button" class="btn btn-secondary" onclick="toggleEdit()">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
    </form>
</div>

<hr>
<form action="{{ url_for('delete',book_id=book.id) }}" method="POST" style="display: inline;">
    <button type="submit" onclick="return confirm('æœ¬å½“ã«å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')">å‰Šé™¤</button>
</form>


<br>
<a href="{{ url_for('index')}}">â† ä¸€è¦§ã«æˆ»ã‚‹</a>

<script>
function toggleEdit(){
     document.getElementById("view-mode").style.display =
        document.getElementById("view-mode").style.display === "none" ? "block" : "none";
    document.getElementById("edit-mode").style.display =
        document.getElementById("edit-mode").style.display === "none" ? "block" : "none";
}
</script>
{% endblock %}
